<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis: Vape Web Server by hacker new</title>
    <style>
      svg.markmap {
        width: 100%;
        height: 100vh;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader@0.18"></script>
  </head>
  <body>
    <div class="markmap">
      <script type="text/template">
        ---
        markmap:
          maxWidth: 300
          colorFreezeLevel: 2
        ---
        # Cháº¡y Web Server trÃªn Vape DÃ¹ng Má»™t Láº§n

        ## ğŸ’¡ Ã tÆ°á»Ÿng Ä‘iÃªn rá»“
        - Ban Ä‘áº§u chá»‰ táº­n dá»¥ng pin tá»« vape cÅ©.
        - PhÃ¡t hiá»‡n vape "xá»‹n" chá»©a MCU 32-bit ARM (PUYA PY32) thay vÃ¬ ASIC.
        - **Thá»­ thÃ¡ch**: Biáº¿n má»™t thá»© vá»©t Ä‘i thÃ nh má»™t web server.

        ## ğŸ”¬ Pháº§n cá»©ng "cÃ¹i báº¯p"
        - **Chip**: PUYA PY32F002B
        - **CPU**: 24MHz Cortex-M0+
        - **Flash**: 24KiB (LÆ°u trá»¯ code)
        - **RAM**: 3KiB (Bá»™ nhá»› táº¡m)
        - HÃ£ng sáº£n xuáº¥t tá»­ táº¿ tá»›i má»©c dÃ¡n nhÃ£n cáº£ chÃ¢n debug.

        ## ğŸ”— Thá»§ thuáº­t káº¿t ná»‘i (Cá»‘t lÃµi cá»§a project)
        - **Váº¥n Ä‘á»**: Chip khÃ´ng cÃ³ Wi-Fi hay Ethernet.
        - **Giáº£i phÃ¡p**: DÃ¹ng **Semihosting**.
          - ÄÃ¢y lÃ  má»™t giao thá»©c **debug** cho ARM.
          - Cho phÃ©p MCU gá»­i "syscall" Ä‘áº¿n mÃ¡y tÃ­nh Ä‘ang debug nÃ³.
          - Biáº¿n má»™t kÃªnh debug thÃ nh má»™t kÃªnh giao tiáº¿p 2 chiá»u.
        - **Táº¡o giao diá»‡n máº¡ng áº£o**:
          - DÃ¹ng **SLIP** (Serial Line Internet Protocol) - giao thá»©c máº¡ng cá»• lá»— sÄ© cháº¡y trÃªn Ä‘Æ°á»ng truyá»n serial.
          - **Luá»“ng dá»¯ liá»‡u**:
            - MCU (Vape) <-Semihosting-> `pyOCD` (PC)
            - `pyOCD` <-Telnet-> `socat` (PC)
            - `socat` táº¡o ra TTY áº£o (cá»•ng serial áº£o)
            - `slattach` (Linux) biáº¿n TTY áº£o thÃ nh giao diá»‡n máº¡ng (`sl0`).

        ## ğŸ’» Stack pháº§n má»m
        - **TrÃªn PC**: `pyOCD`, `socat`, `slattach` Ä‘á»ƒ táº¡o cáº§u ná»‘i.
        - **TrÃªn Vape (MCU)**:
          - **uIP**: Má»™t TCP/IP stack siÃªu nháº¹ cho vi Ä‘iá»u khiá»ƒn.
          - Port code SLIP cá»§a uIP Ä‘á»ƒ cháº¡y qua kÃªnh semihosting.
          - CÃ³ sáºµn má»™t vÃ­ dá»¥ HTTP server tá»‘i giáº£n.

        ## ğŸš€ Tá»‘i Æ°u hÃ³a hiá»‡u nÄƒng
        - **PhiÃªn báº£n Ä‘áº§u**: Cá»±c tá»‡!
          - Ping ~1.5s, máº¥t 50% gÃ³i tin.
          - Táº£i trang > 20 giÃ¢y.
        - **NguyÃªn nhÃ¢n**:
          - I/O theo tá»«ng byte má»™t, overhead cá»§a semihosting quÃ¡ lá»›n.
          - Lá»—i memory alignment trong code checksum cá»§a uIP trÃªn ARM.
        - **Giáº£i phÃ¡p**:
          - DÃ¹ng 3KiB RAM "khá»•ng lá»“" Ä‘á»ƒ táº¡o **ring buffer**.
          - Dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘á»c/ghi theo khá»‘i lá»›n thay vÃ¬ tá»«ng byte.
        - **Káº¿t quáº£ "Blazing Fast"**:
          - Ping: **20ms**.
          - KhÃ´ng máº¥t gÃ³i tin.
          - Táº£i trang: **~160ms**.

        ## âœ¨ TÃ­nh nÄƒng má»Ÿ rá»™ng
        - **TÃ i nguyÃªn sá»­ dá»¥ng**: ~21% Flash, ~45% RAM.
        - Váº«n cÃ²n thá»«a tÃ i nguyÃªn Ä‘á»ƒ cháº¡y tÃ¡c vá»¥ khÃ¡c.
        - ThÃªm má»™t JSON API endpoint Ä‘á»ƒ tráº£ vá» sá»‘ request vÃ  ID cá»§a chip, chá»©ng tá» kháº£ nÄƒng cháº¡y code server-side (dynamic).
      </script>
    </div>
  </body>
</html>